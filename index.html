<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>PhantomJS - The Headles Webkit Browser</title>
		<meta name="description" content="A framework for javascript testing, site scraping, pdf rendering and more">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<link rel="stylesheet" href="css/index.css"/>
	</head>
	<body>
		<div class="reveal">
			<!-- Used to fade in a background when a specific slide state is reached -->
			<div class="state-background"></div>
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<section>
						<h1>PhantomJS</h1>
						<h3>The Headless Webkit</h3>
						<h5> </h5>
						<img src="assets/headless_horseman.jpeg" width="400" height="400"/>
						<aside class="notes">
							-Introduce yourself
							  -name, job, and recently did some work with PhantomJS
							  -want to share findins while they are still fresh in head
						</aside>
					</section>
					<section>
						<h2>Overview</h2>
						<ul style="margin:50px 0 0 0;">
							<li>
							    The Tool
							</li>
							<li>
								The Project
							</li>
							<li>
								Examples
							</li>
						</ul>
						<aside class="notes">
							The project
							 -a little history
							 -the current state of things
						    The tool
						     -what does it do
						     -what is a headless webkit
						     -how to install
						     -api review
						    Why Should I use PhantomJS
						     -purposes
						     -its free
						     -strenghts and weaknesses
						     -buddies of PhantomJS
						</aside>
					</section>
				</section>
				<section>
					<section>
						<h1>The Tool</h1>
						<img src="assets/tool.png" width="400" height="400"/>
						<aside class="notes">
						</aside>
					</section>
					<section>
						<h2>Headless Webkit?</h2>
						<img src="assets/confused.jpeg" width="500px"/>
					</section>
					<section>
						<h2>Chrome or Safari</h2>
						<h5>Webkit with a head</h5>
						<ul>
							<li>Makes HTML requests</li>
							<li>Parses HTML into a DOM structure</li>
							<li>Creates a visual representation of the DOM <br/>(The Head)</li>
						</ul>
					</section>
					<section>
						<h2>Who needs a head?</h2>
						<img style="vertical-align: middle;" src="assets/giant-head.jpeg"/>
						<ul style="vertical-align: middle;">
							<li>
								Unnecessary </br>
								for many tasks
							</li>
							<li>
								It's slow
							</li>
							<li>
								CPU expensive
							</li>
						</ul>
					</section>
					<section>
						<h2>Enter PhantomJS</h2>
						<h5>Webkit without a head</h5>
						<ul>
							<li>Makes HTML requests</li>
							<li>Parses HTML into a DOM structure</li>
							<li>You start scripting the DOM</li>
						</ul>
					</section>
					<section>
						<h2>In One Sentence</h2>
						<blockquote style="margin:60px auto;">
	                        Itâ€™s a command line utility that runs JS scripts in a headless webkit.
						</blockquote>
						<pre><code contenteditable>
$ phantomjs [phantomjs options] my-script.js [script arguments]
						</code></pre>
					</section>
					<section>
						<h2>Also...</h2>
						<blockquote style="margin:60px auto;">
	                        It provides you with a few helpful modules that can be used in the scripts consumed by phantomjs
						</blockquote>
						<pre><code contenteditable>//  my-script.js

//phantomjs gives you these
var sys = require('system');
var webPage = require('webpage');
var fileSystem = require('fs');
var server = require('webserver');
phantom;

// you're amazing code goes here
						</code></pre>
					</section>
					<section>
						<h2>This is not an API review</h2>
						<img src="assets/bored.jpeg" style="margin:10px 0 30px 0;"/>
						<p>Docs are <a href="https://github.com/ariya/phantomjs/wiki/API-Reference" target="_blank">here</a>.
					</section>
					<section>
						<h2>Yeah, yeah so what do I do with it?</h2>
						<img src="assets/angry.jpeg" style="margin:10px 0 30px 0;"/>
					</section>
					<section>
						<h2>Popular Applications</h2>
						<ul>
							<li>
								Running javascript tests
							</li>
							<li>
								Page automation / scraping
							</li>
							<li>
								Screen captures
							</li>
							<li>
								PDF Rendering
							</li>
							<li>
								Network / Performance monitoring
							</li>
						</ul>
					</section>
				</section>
				<section>
					<section>
						<h1>The Project</h1>
						<img src="assets/phantomjsghost.png" width="400" height="400"/>
						<aside class="notes">
							-Introduce yourself
							  -name, job, and recently did some work with PhantomJS
							  -want to share findins while they are still fresh in head
						</aside>
					</section>
					<section>
						<h2>I'm not just the creator</h2>
						<img class="ariya-img" src="assets/ariya.jpeg" height="400"/>
						<h2>I'm also a member</h2>
						<a class="ariya-link" href="https://twitter.com/AriyaHidayat">
							Ariya Hidayat
						</a>
						<aside class="notes">
							Project was founded by Ariya Hidayat in 2010
							Ariya is Director of Engineering at Sencha and is actually a member of the MountainView Javascript meetup group.
						</aside>
					</section>
					<section>
						<h2>Project Info</h2>
						<ul style="vertical-align:middle; margin-right:30px;">
							<li>It's Free</li>
							<li>Open Source</li>
							<li>BSD license</li>
							<li>Windows</li>
							<li>Mac OS X</li>
							<li>Linux</li>
						</ul>
						<img src="assets/awesomesauce.png" style="background: white; border: 10px solid white; vertical-align:middle;" />
					</section>
					<section>
						<h2>The Cool Kids Are Doing It</h2>
						<ul style="vertical-align:middle; margin: 0 5px 0 0;">
							<li>Twitter</li>
							<li>LinkedIn</li>
							<li>Modernizr.js</li>
							<li>Ember.js</li>
							<li>Grunt</li>
							<li>Yeoman</li>
							<li>SurveyMonkey <br/>(shameless)</li>
						</ul>
						<img style="vertical-align: middle;" src="assets/coolkid.jpeg" width="" height=""/>
						<aside class="notes">
							Big companies, startups, and js library developers are incorporating the tool into
							their work flow.
						</aside>
					</section>
					<section>
						<h2>Current Version</h2>
						<ul style="margin: 20px 0 20px 1em;">
							<li>1.7 aka "Blazing Star"</li>
							<li>Released September 22</li>
							<li>Releases every 2-3 months</li>
						</ul>
						<img style="display:block; margin: 0 auto;" src="assets/blazing-star.jpeg"/>

						<aside class="notes">
							Well the project is now two years old. Had the most recent release was
							made a few weeks ago.  From observing the patterns there tends to be a release
							every 2-3 months.  So it has gotten quite a bit of interest and is actively
							beeing developed
						</aside>
					</section>
					<section>
						<h2>Easy Install</h2>
                        <img style="margin:10px auto 30px auto; width:700px;" src="assets/dumb.jpeg"/>
						<p>Download <a target="_blank" href="http://phantomjs.org/download.html" >here</a></p>
						<aside class="notes">
							Install takes less than 5 minutes.  With it's as simple as brew install phantomjs.
						</aside>
					</section>
				</section>
				<section>
					<section>
						<h1>Examples</h1>
						<img src="assets/house.png" width="400" height="400"/>
						<aside class="notes">
						</aside>
					</section>
					<section>
						<h2>Example #1</h2>
						<h4 style="margin:50px 0 50px 0;">Scrape image sources from a URL.</h4>
						<pre><code contenteditable>
$ phantomjs phantom-img-srcs.js &lt;url&gt;

http://somesite.com/image1.jpeg
http://somesite.com/image2.jpeg
http://somesite.com/image3.jpeg
http://somesite.com/image4.jpeg
http://somesite.com/image5.jpeg
								</code></pre>
					</section>
					<section>
						<h2>Design for phantom-img-srcs.js</h2>
						<ol style="margin-top:50px;">
							<li>Parse Console Arguments</li>
							<li>Request The URL</li>
							<li>Scrape Image Sources</li>
							<li>Output to Console</li>
						</ol>
					</section>
					<section>
						<h2>Step 1: Parse Console Arguments</h2>
						<pre><code contenteditable>
// PhantomJS provides you with the system module
var system = require('system');

// The first argument is the name of the
// script that is currently being invoked. phantom-img-srcs.js
scriptName = system.args[0];

// the second argument is the url that we will use to scrape image sources
url = system.args[1];
						</code></pre>
					</section>
					<section>
						<h2>Step 2: Request The URL</h2>
						<pre><code contenteditable>
// PhantomJS provides you with the webpage module
// Need to create an instance
var webPage = require('webpage').create();

//pass a url and a callback that will be invoked
//when the a response is received
webPage.open( url, function(status){

//status will be either 'success' or 'fail'
//now you can start scraping on the url

});
						</code></pre>
					</section>
					<section>
						<h2>Step 3: Scrape Image Sources</h2>
						<pre><code contenteditable>// once we have successfully requested the webPage
// webPage.evaluate creates a sandboxed scripting environment
// for us to interact with the requested DOM
var imgSrcs = webPage.evaluate(function () {
    // Use the new Selectors API because you are runnin webkit
    var imgs = document.querySelectorAll('img');

    // Convert nodeList to array
    imgs = Array.prototype.slice.call(this, 0);

    // Use Javascript 1.6 because you are runnin webkit
    // return an array of the pages image sources
    return imgs.map(function(img){
        return img.src;
    });
});</code></pre>
					</section>
					<section>
						<h2>Step 4: Output To Console</h2>
						<pre><code contenteditable>// we have returned a list of image sources
// from the requested page and are no longer in the sandbox

// Use Javascript 1.6 outside of the sandbox as well
imgSrcs.forEach(function(src){

    // this is how we output to the console
    console.log(src);
});

// exit the phantomjs process
phantom.exit(0);</code></pre>
					</section>
					<section>
						<h2>Demo Example #1</h2>
					</section>
					<section>
						<h2>Good stuff but I can't get my data</h2>
						<div class="reach-image"></div>
					</section>
					<section>
						<h2>Example #3</h2>
						<h4 style="margin:50px 0 50px 0;">Create a web server that returns scraped content in JSON</h4>
						<pre><code contenteditable>$ phantomjs phantom-scrape-server.js
$ curl localhost:8080/?url=http%3A//pinterest.com

[{
    "alt": "",
    "src": "http://passets-ec.pinterest.com/images/search.gif",
    "title": ""
},{
    "alt": "beautiful dresses beautiful dresses",
    "src": "http://media.pinterest.com/upload/fi0I_b.jpg",
    "title": ""
},
...</code></pre>
					</section>

					<section>
						<h2>Design for phantom-scrape-server.js</h2>
						<ol style="margin-top:50px;">
							<li>Start a web server</li>
							<li>Setup a Request Handler</li>
							<li>Scrape Image Data</li>
							<li>Return JSON Response</li>
						</ol>
					</section>
					<section>
						<h2>Step 1: Start a web server</h2>
						<pre><code contenteditable>//PhantomJS provides you with a webserver module
//create an instance
var server = require('webserver').create();

// we will be requiring the webpage module but will not make
// an instance until a request comes in
var WebPage = require('webpage');

//start the server to start listening on port 8080 (localhost:8080)
service = server.listen(8080, function (request, response) {

   //here is where we will write our code to handle requests

});</code></pre>
					</section>
					<section>
						<h2>Step 2: Setup a Request Handler</h2>
						<pre><code contenteditable>// Extract the url that we will use to scrape data from
var queryString = request.url.split("?")[1];
var url = unescape(queryString.split("=")[1]);

// create new instance of webpage to make a request
var webPage = WebPage.create();
webPage.open(url, function(status){

   // here we will write code to scrape the page
   // and return the reponse

});</code></pre>
					</section>
					<section>
						<h2>Step 3: Scrape Image Sources</h2>
						<pre><code contenteditable>var imgData = webPage.evaluate(function(){
    var imgs = document.querySelectorAll("img");

    imgs = Array.prototype.slice.call(imgs,0);

    // Javascript 1.6 function
    return imgs.map(function(img){
        return{
            src: img.src,
            alt: img.alt,
            title: img.title
        };
    });
});</code></pre>
					</section>
					<section>
						<h2>Step 4: Return JSON Response</h2>
						<pre><code contenteditable>//need to release the memory of the webpage
webPage.release();

//form the response
response.statusCode = 200;
response.headers = {
    'Content-Type': "text/javascript"
};
response.write(JSON.stringify(imgData, null, 4));
response.close();</code></pre>
					</section>
					<section>
						<h2>Webserver Module Still Experimental</h2>
                        <img src="assets/Experimental.jpeg"/>
					</section>
					<section>
						<h2>Demo Example #2</h2>
					</section>
					<section>
						<h2>Example #3</h2>
						<h4 style="margin:50px 0 50px 0;">Run Javascript Tests</h4>
						<pre><code contenteditable>
$ phantomjs phantom-qunit.js &lt;test-file&gt;

Pass
Passing
Passed. You should probably drink a beer
								</code></pre>
					</section>
					<section>
						<h2>Design for phantom-qunit.js</h2>
						<ol style="margin-top:50px;">
							<li>Validate Arguments</li>
							<li>Configure WebPage Instance</li>
							<li>Run QUnit test</li>
							<li>Determine test status</li>
							<li>Output Results</li>
						</ol>
					</section>
					<section>
						<h2>Why QUnit?</h2>
						<h4>The simple answer is: We go back.</h4>
						<div class="nostalgia-image"></div>
					    <aside class="notes">
					    	There are other javascript testing frameworks that would totally work as well.
					    	Jasmine is another really popular one.
						</aside>
					</section>
					<section>
					    <h2>Step 1: Validate Arguments</h2>
						<pre><code contenteditable>var system = require('system');
var script = system.args[0];

// add some validation this time
if( system.args.length !== 2 ){

    //report how the script should be invoked
    console.log("Usage: phantomjs " + script + " &lt;test-file&gt;");

    // because this is a failure exit with a non zero status
    phantom.exit(1);
}

//get our test file
var testFile = system.args[1];</code></pre>
					</section>
					<section>
						<h2>Step 2: Configure WebPage Instance</h2>
						<pre><code contenteditable>//if there is a javascript error in the test page
//onError function will be invoked and log erros to the console
webPage.onError = function(msg, trace){
    console.log("Error on the page: " + msg);
    trace.forEach(function(item) {
        console.log('  ', item.file, ':', item.line);
    });
};

//relay console.log calls in the test page to the console
webPage.onConsoleMessage = function(msg){
    console.log(msg);
};

//set the size of the view port that test page will be run in
webPage.viewPortSize = { width: 980, height: 1000 };</code></pre>
					</section>
					<section>
						<h2>Step 3: Run QUnit tests</h2>
						<pre><code contenteditable>webPage.open( testFile, function(status){

    //this time let's validate the page loaded properly
    if ( status !== 'success') {
        console.log("Unable to load " + url);
        phantom.exit(2);
    }

    setInterval(function() {
        //poll for test completion
    }, 100);

});</code></pre>
					</section>
					<section>
						<h2>Step 4: Determine Test Status</h2>
						<pre><code contenteditable>//Inside setInterval so it will repeat until complete
var complete = webPage.evaluate(function () {
    var banner = document.getElementById('qunit-banner');
    var classes = banner.className;
    var failed = classes.indexOf('qunit-fail') !== -1;
    var passed = classes.indexOf('qunit-pass') !== -1;

    if( !failed &amp;&amp; !passed ) return false;
    if(failed) return "failed";
    return "passed";
});
</code></pre>
					</section>
					<section>
						<h2>Tests Are Oblivious To PhantomJS</h2>
						<img src="assets/peepingtom.jpeg"/>
					</section>
					<section>
						<h2>Step 5: Output Results</h2>
						<pre><code contenteditable>//Inside setInterval so it will repeat until complete
if(complete){
    if(complete === "failed"){
        console.log("Failed. You should probably drink a beer");
        phantom.exit(3);
    }

    console.log("Passed. You should probably drink a beer");
    phantom.exit(0);
}</code></pre>
					</section>
					<section>
						<h2>Demo Example #3</h2>
					</section>
					<section>
						<h2>Example #4</h2>
						<h4 style="margin:50px 0 50px 0;">Create a PDF of your web page</h4>
						<pre><code contenteditable>$ phantomjs phantom-pdf.js &lt;arg1&gt; &lt;arg2&gt; ...

Your file was rendered : /path/to/pdf/webpage.pdf</code></pre>
					</section>
					<section>
						<h2>Design for phantom-pdf.js</h2>
						<ol style="margin-top:50px;">
							<li>Validate Arguments</li>
							<li>Parse Arguments</li>
							<li>Configure webpage instance</li>
							<li>Render PDF</li>
						</ol>
					</section>
					<section>
					    <h2>Step 1: Validate Arguments</h2>
						<pre><code contenteditable>var requiredArgs = [
    'script', 'url', 'filename', 'zoomFactor', 'headerHeight',
    'footerHeight' , 'marginTop', 'marginRight','marginBottom',
    'marginLeft', 'orientation', 'format', 'header', 'footer'
];

if(system.args.length !== requiredArgs.length){
    var msgs = requiredArgs.map(function(arg){
        return "<" + arg + ">";
    });
    // the first arg isn't an option so no brackets
    msgs.shift();
    msgs.unshift(system.args[0]);
    console.log("Usage: " + msgs.join());
    phatom.exit(1);
}</code></pre>
					</section>
					<section>
						<h2>Step 2: Parse Arguments</h2>
						<pre><code contenteditable>//put all of our script args into an object
var settings = {};

requiredArgs.forEach(function(value, i){
    settings[requiredArgs[i]] = system.args[i];
});

// settings.url
// settings.footer,
// settings.header
...</code></pre>
					</section>
					<section>
						<h2>Step 3: Configure webpage instance </h2>
						<h4>(1 of 3)</h4>
						<pre><code contenteditable>
webPage.paperSize = {
    header: {
        height: settings.headerHeight,
        contents: phantom.callback(function(pageNum, numPages) {
            return settings.header
                       .replace("#pageNum#", pageNum)
                       .replace("#numPages#", numPages);
        })
    },
...
}</code></pre>
					    <aside class="notes">
							// the webpage.papersize property is where
                            // you configure how the page should be printed
                            //Every time a new page is rendered by PhantomJS
                            //this will get invoked
						</aside>
					</section>
					<section>
						<h2>Step 3: Configure webpage instance </h2>
						<h4>(2 of 3)</h4>
						<pre><code contenteditable>webPage.paperSize = {
...
    footer: {
        height: settings.footerHeight,
        contents: phantom.callback(function(pg, pgs) {
            return settings.footer
                       .replace("#pg#", pg)
                       .replace("#pgs#", pgs);
        })
    },
...
}</code></pre>
					</section>
					<section>
						<h2>Step 3: Configure webpage</h2>
						<h4>(3 of 3)</h4>
						<pre><code contenteditable>webPage.paperSize = {
...
    margin: {
        top: settings.marginTop,
        right: settings.marginRight,
        bottom: settings.marginBottom,
        left: settings.marginLeft
    },
    orientation: settings.orientation,
    format: settings.format
};

webPage.zoomFactor = parseFloat(settings.zoomFactor);</code></pre>
					</section>
					<section>
						<h2>Step 4: Render PDF</h2>
						<pre><code contenteditable>webPage.open( settings.url, function(status){

    // ensure that the filename ends in .pdf because
    // this is the instruction to render a pdf vs. png or jpeg
    if(settings.filename.substring(-4).toLowerCase() !== ".pdf"){
	    settings.filename += ".pdf";
	}

    //writes the pdf file to disk
    webPage.render(filename);
    phantom.exit(0);
});</code></pre>
					</section>
					<section>
						<h2>Biggest Selling Point</h2>
						<blockquote style="margin:100px auto 100px auto;">
							Since PhantomJS is using WebKit, it can render HTML/CSS, SVG and Canvas to PDF the way users see it on your website.
						</blockquote>
						<h6>psssst and it's free</h6>
					</section>
					<section>
						<h2>Printed Pages Should Be Oblivious Too</h2>
						<img src="assets/peepingtom.jpeg"/>
					</section>
					<section>
						<h2>Demo Example #4<h2>
					</section>
				</section>
				<section>
					<section>
						<h2>Is it right for me?</h2>
						<img src="assets/dudeinheels.jpeg"/>
						<aside class="notes">
						</aside>
					</section>
				</section>
			</div>
			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
			</aside>
			<!-- Presentation progress bar -->
			<div class="progress"><span></span></div>
		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>
		<script>
			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,

				theme: Reveal.getQueryHash().theme || 'default', // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/linear(2d)

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/highlight.js', async: true, callback: function() { window.hljs.initHighlightingOnLoad(); } },
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'lib/js/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'lib/js/data-markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '/socket.io/socket.io.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
					{ src: 'plugin/speakernotes/client.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
				]
			});
		</script>
	</body>
</html>
